<!DOCTYPE html>
<html lang="es" class="dark" id="rootHtml">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Quilmes{% endblock %}</title>

  <!-- Tailwind + estilos + fuentes + iconos -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/static/css/style.css?v=2.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/lucide@latest"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- Sistema de Modales Glassmorphism (cargar antes que otros scripts) -->
  <script src="/static/js/modal.js?v=4.0"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    
    .animate-slide-in-left {
      animation: slideInLeft 0.3s ease-out;
    }
    
    .animate-fade-in-up {
      animation: fadeInUp 0.4s ease-out;
    }
    
    .glass-effect {
      background: rgba(17, 24, 39, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    
    .sidebar-gradient {
      background: linear-gradient(180deg, #0f172a 0%, #020617 50%, #0f172a 100%);
    }
    
    .hover-lift {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }
    
    /* Scrollbar personalizado */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #1e293b;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #475569;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #64748b;
    }
  </style>
</head>

<body class="bg-gradient-to-br from-[#020617] via-[#0a1628] to-[#020617] text-gray-100 font-inter min-h-screen overflow-y-auto" x-data="{ sidebarOpen: false }">

  {% if user %}
  <!-- Usuario de sesion actual (oculto, para JavaScript) -->
  <div id="sesionActual" data-usuario-sesion="{{ user.usuario }}" style="display: none;"></div>

  <!-- Overlay para móvil -->
  <div 
    x-show="sidebarOpen" 
    @click="sidebarOpen = false"
    x-transition:enter="transition-opacity ease-linear duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition-opacity ease-linear duration-300"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden"
    style="display: none;"
  ></div>

  <!-- Botón hamburguesa móvil -->
  <button 
    @click="sidebarOpen = !sidebarOpen"
    class="fixed top-4 left-4 z-50 lg:hidden p-2.5 rounded-lg glass-effect border border-white/10 hover:border-emerald-400/50 transition-all hover-lift"
  >
    <i data-lucide="menu" class="w-6 h-6 text-emerald-400"></i>
  </button>

  <!-- Sidebar con animación responsive -->
  <aside 
    :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'"
    class="fixed top-0 left-0 w-72 h-screen sidebar-gradient border-r border-white/10 flex flex-col py-6 px-4 z-50 transition-transform duration-300 ease-in-out shadow-2xl">
    <!-- Branding con diseño moderno -->
    <div class="mb-10 pl-1 animate-slide-in-left">
      <a href="/home" class="flex flex-col gap-2 group">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
            <i data-lucide="shield-check" class="w-6 h-6 text-white"></i>
          </div>
          <div>
            <span class="text-lg font-bold text-white tracking-tight block">
              LOS QUILMES
            </span>
            <span class="text-xs text-emerald-400 font-medium">
              Sistema SMS
            </span>
          </div>
        </div>
      </a>
    </div>

    <!-- Navegacion moderna -->
    <nav class="flex flex-col gap-2 text-sm font-medium text-gray-200">
      <!-- Verificar -->
      <a href="/verificar"
         @click.prevent="sidebarOpen = false; window.location.href = '/verificar'"
         class="relative flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200
                {% if active_page == 'verificar' %}
                  glass-effect text-emerald-300 shadow-lg border border-emerald-500/30
                {% else %}
                  hover:glass-effect hover:text-emerald-300 border border-transparent hover:border-white/10
                {% endif %}">
        {% if active_page == 'verificar' %}
        <span class="absolute left-0 w-1 h-8 rounded-r-full bg-gradient-to-b from-emerald-400 to-emerald-600 shadow-lg shadow-emerald-500/50"></span>
        {% endif %}
        <div class="{% if active_page == 'verificar' %}bg-emerald-500/20{% else %}bg-white/5{% endif %} p-2 rounded-lg transition-colors">
          <i data-lucide="shield-check" class="w-4 h-4"></i>
        </div>
        <span class="font-medium">Verificar SMS</span>
      </a>

      {% if user.rol|lower in ['admin', 'operador'] %}
      <!-- SMS Enviados -->
      <a href="/admin/sms"
         @click.prevent="sidebarOpen = false; window.location.href = '/admin/sms'"
         class="relative flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200
                {% if active_page == 'sms' %}
                  glass-effect text-emerald-300 shadow-lg border border-emerald-500/30
                {% else %}
                  hover:glass-effect hover:text-emerald-300 border border-transparent hover:border-white/10
                {% endif %}">
        {% if active_page == 'sms' %}
        <span class="absolute left-0 w-1 h-8 rounded-r-full bg-gradient-to-b from-emerald-400 to-emerald-600 shadow-lg shadow-emerald-500/50"></span>
        {% endif %}
        <div class="{% if active_page == 'sms' %}bg-emerald-500/20{% else %}bg-white/5{% endif %} p-2 rounded-lg transition-colors">
          <i data-lucide="send" class="w-4 h-4"></i>
        </div>
        <span class="font-medium">SMS Enviados</span>
      </a>
      {% endif %}

      {% if user.rol|lower == 'admin' %}
      <!-- Usuarios -->
      <a href="/mantenimiento/gestion"
         @click.prevent="sidebarOpen = false; window.location.href = '/mantenimiento/gestion'"
         class="relative flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200
                {% if active_page == 'usuarios' %}
                  glass-effect text-emerald-300 shadow-lg border border-emerald-500/30
                {% else %}
                  hover:glass-effect hover:text-emerald-300 border border-transparent hover:border-white/10
                {% endif %}">
        {% if active_page == 'usuarios' %}
        <span class="absolute left-0 w-1 h-8 rounded-r-full bg-gradient-to-b from-emerald-400 to-emerald-600 shadow-lg shadow-emerald-500/50"></span>
        {% endif %}
        <div class="{% if active_page == 'usuarios' %}bg-emerald-500/20{% else %}bg-white/5{% endif %} p-2 rounded-lg transition-colors">
          <i data-lucide="user-cog" class="w-4 h-4"></i>
        </div>
        <span class="font-medium">Usuarios</span>
      </a>

      <!-- Registros del Sistema (con submenús) -->
      <div x-data="{ openRegistros: false }" class="relative">
        <button @click="openRegistros = !openRegistros"
                class="w-full relative flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200
                       {% if active_page in ['uso', 'metricas'] %}
                         glass-effect text-emerald-300 shadow-lg border border-emerald-500/30
                       {% else %}
                         hover:glass-effect hover:text-emerald-300 border border-transparent hover:border-white/10
                       {% endif %}">
          {% if active_page in ['uso', 'metricas'] %}
          <span class="absolute left-0 w-1 h-8 rounded-r-full bg-gradient-to-b from-emerald-400 to-emerald-600 shadow-lg shadow-emerald-500/50"></span>
          {% endif %}
          <div class="{% if active_page in ['uso', 'metricas'] %}bg-emerald-500/20{% else %}bg-white/5{% endif %} p-2 rounded-lg transition-colors">
            <i data-lucide="activity" class="w-4 h-4"></i>
          </div>
          <span class="font-medium flex-1 text-left">Registros del Sistema</span>
          <i data-lucide="chevron-down" class="w-4 h-4 transition-transform" :class="openRegistros ? 'rotate-180' : ''"></i>
        </button>
        
        <!-- Submenús -->
        <div x-show="openRegistros" 
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 transform scale-95"
             x-transition:enter-end="opacity-100 transform scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 transform scale-100"
             x-transition:leave-end="opacity-0 transform scale-95"
             class="mt-2 ml-4 space-y-1 border-l-2 border-white/10 pl-3"
             style="display: none;">
          
          <a href="/registros/uso"
             @click.prevent="sidebarOpen = false; window.location.href = '/registros/uso'"
             class="flex items-center gap-2 px-3 py-2 rounded-lg text-xs transition-all
                    {% if active_page == 'uso' %}
                      bg-emerald-500/20 text-emerald-300
                    {% else %}
                      hover:bg-white/5 text-gray-300 hover:text-emerald-300
                    {% endif %}">
            <i data-lucide="database" class="w-3.5 h-3.5"></i>
            <span>Uso SMS</span>
          </a>
          
          <a href="/registros/metricas"
             @click.prevent="sidebarOpen = false; window.location.href = '/registros/metricas'"
             class="flex items-center gap-2 px-3 py-2 rounded-lg text-xs transition-all
                    {% if active_page == 'metricas' %}
                      bg-emerald-500/20 text-emerald-300
                    {% else %}
                      hover:bg-white/5 text-gray-300 hover:text-emerald-300
                    {% endif %}">
            <i data-lucide="bar-chart-3" class="w-3.5 h-3.5"></i>
            <span>Métricas</span>
          </a>
        </div>
      </div>

      <!-- Configuración -->
      <a href="/configuracion"
         @click.prevent="sidebarOpen = false; window.location.href = '/configuracion'"
         class="relative flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200
                {% if active_page == 'configuracion' %}
                  glass-effect text-emerald-300 shadow-lg border border-emerald-500/30
                {% else %}
                  hover:glass-effect hover:text-emerald-300 border border-transparent hover:border-white/10
                {% endif %}">
        {% if active_page == 'configuracion' %}
        <span class="absolute left-0 w-1 h-8 rounded-r-full bg-gradient-to-b from-emerald-400 to-emerald-600 shadow-lg shadow-emerald-500/50"></span>
        {% endif %}
        <div class="{% if active_page == 'configuracion' %}bg-emerald-500/20{% else %}bg-white/5{% endif %} p-2 rounded-lg transition-colors">
          <i data-lucide="settings" class="w-4 h-4"></i>
        </div>
        <span class="font-medium">Configuración</span>
      </a>
      {% endif %}
    </nav>

    <!-- Usuario info + Boton Salir -->
    <div class="mt-auto pt-6 border-t border-white/10 space-y-4">
      <!-- Info de usuario -->
      <div class="glass-effect border border-white/10 rounded-xl p-3 space-y-2">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center text-white font-bold text-sm">
            {{ user.usuario[0]|upper }}
          </div>
          <div class="flex-1 min-w-0">
            <div id="nombreUsuarioSidebar" class="text-sm font-semibold text-white truncate">{{ user.usuario }}</div>
            <div class="text-xs text-emerald-400 capitalize">{{ user.rol }}</div>
          </div>
        </div>
      </div>
      
      <!-- Botón salir mejorado -->
      <a href="/logout"
         class="w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-gradient-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 text-white text-sm font-semibold shadow-lg hover-lift transition-all duration-200 border border-red-400/20">
        <i data-lucide="log-out" class="w-4 h-4"></i>
        <span>Cerrar Sesión</span>
      </a>
      
      <!-- Footer info -->
      <div class="text-[10px] text-center text-gray-500 leading-relaxed space-y-0.5">
        <div>Soporte técnico</div>
        <div class="text-emerald-400">vallefernando884@gmail.com</div>
      </div>
    </div>
  </aside>
  {% endif %}

  <!-- Panel principal responsive -->
  <main class="{% if user %}lg:ml-72{% endif %} min-h-screen px-4 sm:px-6 lg:px-8 pt-20 lg:pt-8 pb-10">
    <div class="max-w-7xl mx-auto">
      {% block contenido %}{% endblock %}
    </div>
  </main>

  <!-- Contenedor de Toasts (IMPORTANTE: debe estar antes de los scripts) -->
  <div id="toastContainer" class="fixed top-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none"></div>

  {% block scripts %}
    <script>lucide.createIcons();</script>
  {% endblock %}
</body>
</html>